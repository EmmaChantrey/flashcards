{% extends 'cards/header.html' %}

{% block title %}Edit Flashcard Set{% endblock %}

{% block content %}
{% load static %}
<a href="{% url 'dashboard' %}" class="loginbtn">Back to Dashboard</a>
<h1>Edit Flashcard Set</h1>
<form method="post" id="flashcard-set-form">
    {% csrf_token %}
    <div class="form-group">
        {{ flashcard_set_form.name }}
    </div>

    <div id="flashcard-form-container">
        {{ flashcard_formset.management_form }}
        {% for form in flashcard_formset %}
        <div class="flashcard-pair">
            <div class="form-group term-definition">
                {{ form.term }}
            </div>
            <div class="form-group term-definition">
                {{ form.definition }}
            </div>
            <div class="form-group delete-button">
                <div class="form-group delete">
                    <button type="button" class="delete-btn"><img src = "{% static 'images/x.png' %}" alt="Delete pair"/></button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <button type="button" id="add-more-btn"><img src="{% static 'images/plus.png' %}" alt="Add another pair"></button>
    <button type="submit">Save Changes</button>
</form>

<script>
    document.getElementById('add-more-btn').addEventListener('click', function () {
        const container = document.getElementById('flashcard-form-container');
        const totalForms = document.querySelector('#id_form-TOTAL_FORMS');
        const newIndex = parseInt(totalForms.value, 10);

        // Create a new flashcard pair row
        let newRow = document.createElement('div');
        newRow.classList.add('flashcard-pair');
        newRow.innerHTML = `
            <div class="form-group term-definition">
                <input type="text" name="form-${newIndex}-term" id="id_form-${newIndex}-term" class="form-control" placeholder="Term">
            </div>
            <div class="form-group term-definition">
                <input type="text" name="form-${newIndex}-definition" id="id_form-${newIndex}-definition" class="form-control" placeholder="Definition">
            </div>
            <div class="form-group delete-button">
                <button type="button" class="delete-btn">
                    <img src="{% static 'images/x.png' %}" alt="Delete pair" />
                </button>
            </div>
        `;

        // Append the new row to the container
        container.appendChild(newRow);

        // Increment the TOTAL_FORMS count
        totalForms.value = newIndex + 1;
    });

    // Attach a single event listener to the container for all delete buttons
    document.getElementById('flashcard-form-container').addEventListener('click', function (event) {
        if (event.target.closest('.delete-btn')) {
            const row = event.target.closest('.flashcard-pair');
            if (row) {
                row.remove();

                // Update TOTAL_FORMS count
                const totalForms = document.querySelector('#id_form-TOTAL_FORMS');
                const rows = document.querySelectorAll('.flashcard-pair');
                totalForms.value = rows.length;
            }
        }
    });
</script>
{% endblock %}