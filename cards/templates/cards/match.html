{% extends 'cards/header.html' %}

{% block title %}Match: {{ flashcard_set.name }}{% endblock %}
{% block content %}
<div class="flashcard-nav-header">
    <div class="flashcard-nav-title">
        <h1>Match</h1>
    </div>
    <div class="flashcard-nav-buttons">
        <a href="{% url 'study' flashcard_set.id %}" class="loginbtn">Back</a>
    </div>
</div>

<div class="game-box">
    <div class="grid-container">
        {% for item in items %}
            <div class="grid-item" id="{{ item.id }}" tabindex="0">
                {{ item.value }}
            </div>
        {% endfor %}
    </div>
</div>


<a href="{% url 'game_end' flashcard_set.id %}" style="display: none;" class="check-button">Next</a>




<script>
    document.addEventListener('DOMContentLoaded', () => {
        const gridItems = document.querySelectorAll('.grid-item');
        const nextButtonContainer = document.querySelector('.check-button');
        let selectedItems = [];
    
        gridItems.forEach(item => {
            // Click event handler for mouse interaction
            item.addEventListener('click', () => handleSelection(item));
    
            // Keydown event handler for keyboard interaction (Tab + Enter/Space)
            item.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' || event.key === ' ') {
                    handleSelection(item);
                }
            });
        });
    
        function handleSelection(item) {
            // Toggle selection state
            if (item.classList.contains('selected')) {
                item.classList.remove('selected');
                selectedItems = selectedItems.filter(el => el !== item);
            } else {
                item.classList.add('selected');
                selectedItems.push(item);
            }
    
            // If two items are selected, check for a match
            if (selectedItems.length === 2) {
                const [first, second] = selectedItems;
    
                if (first.id === second.id) {
                    first.classList.add('hidden');
                    second.classList.add('hidden');
                    console.log(`Matched: ${first.textContent} and ${second.textContent}`);
                } else {
                    console.log(`No match: ${first.textContent} and ${second.textContent}`);
                }
    
                // Reset selection state after delay
                setTimeout(() => {
                    selectedItems.forEach(el => el.classList.remove('selected'));
                    selectedItems = [];
                }, 1000);
            }
    
            // Check if all items are matched
            if ([...gridItems].every(item => item.classList.contains('hidden'))) {
                nextButtonContainer.style.display = 'block'; // Show the "Next" button
            }
        }
    });
    </script>

{% endblock %}